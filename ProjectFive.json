{"paragraphs":[{"text":" val taxi2018 = spark.read.format(\"csv\").option(\"header\", true).option(\"inferSchema\", true).load(\"/user/zeppelin/taxi/taxi2018.csv\")\ntaxi2018.count()","user":"anonymous","dateUpdated":"2023-12-04T15:45:46+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"taxi2018: org.apache.spark.sql.DataFrame = [VendorID: int, tpep_pickup_datetime: string ... 15 more fields]\nres0: Long = 55918\n"}]},"apps":[],"jobName":"paragraph_1701456019897_389016830","id":"20231201-184019_1298162740","dateCreated":"2023-12-01T18:40:19+0000","dateStarted":"2023-12-04T15:18:17+0000","dateFinished":"2023-12-04T15:19:35+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:15919"},{"text":"import org.apache.spark.sql._\ntaxi2018.createOrReplaceTempView(\"taxi2018\")\nspark.sqlContext.sql(\"SELECT count(*) FROM taxi2018 where passenger_count == 1\").show()\nspark.sqlContext.sql(\"SELECT count(*) FROM taxi2018 where passenger_count > 1\").show()\n","user":"anonymous","dateUpdated":"2023-12-04T15:20:14+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql._\n+--------+\n|count(1)|\n+--------+\n|   39670|\n+--------+\n\n+--------+\n|count(1)|\n+--------+\n|   15752|\n+--------+\n\n"}]},"apps":[],"jobName":"paragraph_1701458533117_1676536603","id":"20231201-192213_659772254","dateCreated":"2023-12-01T19:22:13+0000","dateStarted":"2023-12-04T15:20:15+0000","dateFinished":"2023-12-04T15:20:25+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:15920"},{"text":"import org.apache.spark.sql._\ntaxi2018.createOrReplaceTempView(\"taxi2018\")\nspark.sqlContext.sql(\"SELECT avg(trip_distance) FROM taxi2018 where tolls_amount > 0\").show()\nspark.sqlContext.sql(\"SELECT avg(trip_distance) FROM taxi2018 where tolls_amount == 0\").show()","user":"anonymous","dateUpdated":"2023-12-04T15:21:16+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql._\n+------------------+\n|avg(trip_distance)|\n+------------------+\n| 13.02193067703271|\n+------------------+\n\n+------------------+\n|avg(trip_distance)|\n+------------------+\n|2.3433514413885654|\n+------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1701458901181_-421361232","id":"20231201-192821_598364429","dateCreated":"2023-12-01T19:28:21+0000","dateStarted":"2023-12-04T15:21:16+0000","dateFinished":"2023-12-04T15:21:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:15921"},{"text":"spark.sqlContext.sql(\"SELECT left(tpep_pickup_datetime,2) AS month, sum(fare_amount)/count(*) as avg_fare FROM taxi2018 where fare_amount > 0 and fare_amount / trip_distance < 10000 group by left(tpep_pickup_datetime,2) order by month\").show()","user":"anonymous","dateUpdated":"2023-12-04T15:21:26+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----+------------------+\n|month|          avg_fare|\n+-----+------------------+\n|   01|12.381402298850574|\n|   02|12.148956584312785|\n|   03|12.528635446532867|\n|   04|12.936855154414964|\n|   05|13.595211546936978|\n|   06|12.845854004252303|\n|   07|13.326148683531233|\n|   08|13.353933418693982|\n|   09|12.652934236947791|\n|   10|13.511325791855203|\n|   11|13.231794294294295|\n|   12|13.234322371699053|\n+-----+------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1701460147581_-1445798721","id":"20231201-194907_1430390829","dateCreated":"2023-12-01T19:49:07+0000","dateStarted":"2023-12-04T15:21:26+0000","dateFinished":"2023-12-04T15:21:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:15922"},{"text":"import org.apache.spark.sql.expressions._\nval stamp = taxi2018.withColumn(\"time_stamp\", unix_timestamp($\"tpep_pickup_datetime\",  \"MM/dd/yyyy hh:mm:ss a\"))\nval hour = stamp.withColumn(\"hour\", ($\"time_stamp\" / 3600) % 24)\nval hourWithGroup = hour.withColumn(\"hour_group\",\n  when(col(\"hour\") < 12, 1)\n    .when(col(\"hour\") >= 12, 2))\nval windowSpec = Window.partitionBy(\"hour_group\")\nval answer = hourWithGroup.withColumn(\"sum_amount\", sum(hourWithGroup(\"fare_amount\")).over(windowSpec)).withColumn(\"total_tip\", sum(hourWithGroup(\"tip_amount\")).over(windowSpec))\nanswer.createOrReplaceTempView(\"hourWithGroup\")\nspark.sqlContext.sql(\"SELECT DISTINCT hour_group, (total_tip/sum_amount) FROM hourWithGroup\").show()\n","user":"anonymous","dateUpdated":"2023-12-04T16:07:35+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.expressions._\nstamp: org.apache.spark.sql.DataFrame = [VendorID: int, tpep_pickup_datetime: string ... 16 more fields]\nhour: org.apache.spark.sql.DataFrame = [VendorID: int, tpep_pickup_datetime: string ... 17 more fields]\nhourWithGroup: org.apache.spark.sql.DataFrame = [VendorID: int, tpep_pickup_datetime: string ... 18 more fields]\nwindowSpec: org.apache.spark.sql.expressions.WindowSpec = org.apache.spark.sql.expressions.WindowSpec@1f51c7e0\nanswer: org.apache.spark.sql.DataFrame = [VendorID: int, tpep_pickup_datetime: string ... 20 more fields]\n+----------+------------------------+\n|hour_group|(total_tip / sum_amount)|\n+----------+------------------------+\n|         1|     0.14224423010382842|\n|         2|     0.14428057548292553|\n+----------+------------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1701459290046_-1445625222","id":"20231201-193450_607095497","dateCreated":"2023-12-01T19:34:50+0000","dateStarted":"2023-12-04T16:07:23+0000","dateFinished":"2023-12-04T16:07:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:15923"},{"text":"val filtered = taxi2018.withColumn(\"pickup_time_stamp\", unix_timestamp($\"tpep_pickup_datetime\",  \"MM/dd/yyyy hh:mm:ss a\")).withColumn(\"dropoff_time_stamp\", unix_timestamp($\"tpep_dropoff_datetime\",  \"MM/dd/yyyy hh:mm:ss a\")).filter($\"trip_distance\" > 0)\nfiltered.createOrReplaceTempView(\"filtered\")\nspark.sqlContext.sql(\"SELECT *, ((dropoff_time_stamp-pickup_time_stamp)/trip_distance) as time_over_dist FROM filtered order by time_over_dist DESC limit 10\").show()","user":"anonymous","dateUpdated":"2023-12-04T16:21:55+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"filtered: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [VendorID: int, tpep_pickup_datetime: string ... 17 more fields]\n+--------+--------------------+---------------------+---------------+-------------+----------+------------------+------------+------------+------------+-----------+-----+-------+----------+------------+---------------------+------------+-----------------+------------------+------------------+\n|VendorID|tpep_pickup_datetime|tpep_dropoff_datetime|passenger_count|trip_distance|RatecodeID|store_and_fwd_flag|PULocationID|DOLocationID|payment_type|fare_amount|extra|mta_tax|tip_amount|tolls_amount|improvement_surcharge|total_amount|pickup_time_stamp|dropoff_time_stamp|    time_over_dist|\n+--------+--------------------+---------------------+---------------+-------------+----------+------------------+------------+------------+------------+-----------+-----+-------+----------+------------+---------------------+------------+-----------------+------------------+------------------+\n|       2|02/06/2018 02:28:...| 02/07/2018 02:21:...|              2|         0.29|         1|                 N|         230|         164|           2|        4.0|  0.0|    0.5|       0.0|         0.0|                  0.3|         4.8|       1517927283|        1518013284| 296555.1724137931|\n|       2|04/16/2018 07:33:...| 04/17/2018 06:45:...|              1|         0.45|         1|                 N|         181|         181|           2|        4.0|  1.0|    0.5|       0.0|         0.0|                  0.3|         5.8|       1523907228|        1523990727|185553.33333333334|\n|       2|03/15/2018 09:47:...| 03/16/2018 09:45:...|              1|         0.47|         1|                 N|          75|          75|           2|        4.5|  0.5|    0.5|       0.0|         0.0|                  0.3|         5.8|       1521150458|        1521236734|183565.95744680852|\n|       2|06/08/2018 12:23:...| 06/08/2018 02:34:...|              1|         0.05|         2|                 N|         132|         142|           1|       52.0|  0.0|    0.5|     15.84|         0.0|                  0.3|       68.64|       1528417416|        1528425274|          157160.0|\n|       2|01/20/2018 05:37:...| 01/21/2018 04:38:...|              1|         0.63|         1|                 N|          48|         142|           1|        4.0|  0.0|    0.5|      0.96|         0.0|                  0.3|        5.76|       1516469832|        1516552733|131588.88888888888|\n|       2|11/27/2018 06:48:...| 11/28/2018 06:27:...|              5|         0.69|         1|                 N|         262|         263|           2|        5.0|  1.0|    0.5|       0.0|         0.0|                  0.3|         6.8|       1543344488|        1543429622|123382.60869565219|\n|       2|03/27/2018 02:11:...| 03/28/2018 02:09:...|              1|         0.79|         1|                 N|         170|         186|           2|        5.5|  0.5|    0.5|       0.0|         0.0|                  0.3|         6.8|       1522116706|        1522202953|109173.41772151898|\n|       2|03/07/2018 06:28:...| 03/08/2018 05:32:...|              1|         0.77|         1|                 N|         143|          48|           1|        5.0|  1.0|    0.5|      1.02|         0.0|                  0.3|        7.82|       1520447282|        1520530378|107916.88311688311|\n|       2|11/02/2018 05:49:...| 11/03/2018 05:43:...|              1|         0.82|         1|                 N|         161|         233|           2|        8.5|  1.0|    0.5|       0.0|         0.0|                  0.3|        10.3|       1541180975|        1541267000|104908.53658536586|\n|       2|06/06/2018 12:51:...| 06/07/2018 12:49:...|              1|         0.83|         1|                 N|         170|         161|           1|       12.5|  0.0|    0.5|      2.66|         0.0|                  0.3|       15.96|       1528289479|        1528375784|103981.92771084337|\n+--------+--------------------+---------------------+---------------+-------------+----------+------------------+------------+------------+------------+-----------+-----+-------+----------+------------+---------------------+------------+-----------------+------------------+------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1701466315780_1688513301","id":"20231201-213155_1148394100","dateCreated":"2023-12-01T21:31:55+0000","dateStarted":"2023-12-04T16:21:55+0000","dateFinished":"2023-12-04T16:21:58+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:15924"},{"text":"val hourFiltered = hour.filter($\"hour\" >= 16).filter($\"hour\" <= 23).filter($\"total_amount\" <= 200)\nval windowSpec = Window.orderBy(\"hour\").rangeBetween(0,1)\nval answer = hourFiltered.withColumn(\"total_average\", avg(hourFiltered(\"total_amount\")).over(windowSpec))\nanswer.createOrReplaceTempView(\"answerTable\")\nspark.sqlContext.sql(\"SELECT CONCAT(right(tpep_pickup_datetime,12), ' - ', CONCAT(cast(substr(tpep_pickup_datetime, 12, 2) + 1 as int), substr(tpep_pickup_datetime, 14, 4), cast(substr(tpep_pickup_datetime, 18, 2) - 1 as int), substr(tpep_pickup_datetime, 20, 3))) AS Best_Window FROM answerTable ORDER BY total_average DESC limit 1\").show(truncate=false)\n","user":"anonymous","dateUpdated":"2023-12-04T18:14:29+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"hourFiltered: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [VendorID: int, tpep_pickup_datetime: string ... 17 more fields]\nwindowSpec: org.apache.spark.sql.expressions.WindowSpec = org.apache.spark.sql.expressions.WindowSpec@40178910\nanswer: org.apache.spark.sql.DataFrame = [VendorID: int, tpep_pickup_datetime: string ... 18 more fields]\n+--------------------------+\n|Best_Window               |\n+--------------------------+\n| 10:57:38 PM - 11:57:37 PM|\n+--------------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1701706280748_-1264191005","id":"20231204-161120_100525436","dateCreated":"2023-12-04T16:11:20+0000","dateStarted":"2023-12-04T18:14:29+0000","dateFinished":"2023-12-04T18:14:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:15925"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1701708511500_382153351","id":"20231204-164831_1563221620","dateCreated":"2023-12-04T16:48:31+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:15926"}],"name":"Project5","id":"2JHK4B8XW","angularObjects":{"2CHS8UYQQ:shared_process":[],"2C8A4SZ9T_livy2:shared_process":[],"2CK8A9MEG:shared_process":[],"2C4U48MY3_spark2:shared_process":[],"2CKAY1A8Y:shared_process":[],"2CKEKWY8Z:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}